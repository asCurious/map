<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>نقشه خاک‌شناسی</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
      #map {
        height: 600px;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <select id="locationSelect">
      <option value="">انتخاب موقعیت</option>
      <option value="35.6892,51.3890">تهران</option>
      <option value="32.6539,51.6660">اصفهان</option>
      <option value="29.5926,52.5836">شیراز</option>
    </select>
    <button id="drawPolygon">رسم محدوده</button>
    <button id="clearPolygon">پاک کردن محدوده</button>

    <script>
      let map = L.map("map").setView([32.4279, 53.688], 8);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(
        map
      );

      let markers = [];
      let polygon = null;

      document
        .getElementById("locationSelect")
        .addEventListener("change", function () {
          let coords = this.value.split(",");
          if (coords.length === 2) {
            map.setView([parseFloat(coords[0]), parseFloat(coords[1])], 14);
          }
        });

      document
        .getElementById("drawPolygon")
        .addEventListener("click", function () {
          map.on("click", addMarker);
        });

      document
        .getElementById("clearPolygon")
        .addEventListener("click", clearPolygon);

      function addMarker(e) {
        if (markers.length < 3) {
          let marker = L.marker(e.latlng).addTo(map);
          markers.push(marker);

          if (markers.length === 3) {
            drawPolygon();
            map.off("click", addMarker);
          }
        }
      }

      function drawPolygon() {
        let polygonPoints = markers.map((marker) => marker.getLatLng());
        if (polygon) {
          map.removeLayer(polygon);
        }
        polygon = L.polygon(polygonPoints, { color: "red" }).addTo(map);

        // اینجا می‌توانید اطلاعات مربوط به محدوده را نمایش دهید
        console.log("محدوده انتخاب شده:", polygonPoints);
      }

      function clearPolygon() {
        markers.forEach((marker) => map.removeLayer(marker));
        markers = [];
        if (polygon) {
          map.removeLayer(polygon);
          polygon = null;
        }
        map.off("click", addMarker);
      }
      let locations = [
        { name: "مختصات اول", latLng: [35.6892, 51.389] },
        { name: "مختصات دوم", latLng: [32.6539, 51.666] },
        { name: "مختصات سوم", latLng: [29.5926, 52.5836] },
        // اضافه کردن مختصات دیگر
      ];
      locations.forEach(function (location) {
        L.marker(location.latLng).bindPopup(location.name).addTo(map);
      });
    </script>
  </body>
</html>
